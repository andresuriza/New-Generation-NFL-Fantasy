@startuml C2
title New Generation NFL Fantasy — Arquitectura Lógica/Física (C2)

skinparam dpi 140
skinparam rectangle {
  RoundCorner 12
}
skinparam packageStyle rectangle
left to right direction

actor "Usuario / Visitante" as Usuario
actor "Operaciones X-NFL\n(Admin / Soporte)" as Admin

rectangle "NG NFL Fantasy\n(Sistema en la nube)" as Sistema #LightBlue {
  node "Frontend Web\n(React / Next.js)" as FRONT
  node "Backend API\n(Python / FastAPI)" as BACK {
    frame "API Layer" as APILayer {
      component "REST Routers"
    }
    frame "Business Logic" as BusinessLayer {
      component "Services"
    }
    frame "Validation Layer" as ValidationLayer {
      component "Validators"
    }
    frame "Data Access" as DataLayer {
      component "Repositories"
    }
  }
  database "PostgreSQL" as DB

  FRONT -[#DarkGreen]-> APILayer : REST / HTTPS
  APILayer -[#DarkGreen]-> BusinessLayer : Business operations
  BusinessLayer -[#DarkGreen]-> ValidationLayer : Rule validation
  BusinessLayer -[#DarkGreen]-> DataLayer : Data access
  DataLayer -[#DarkGreen]-> DB : SQL queries

  FRONT -[#DarkGreen]-> UsuariosRouter : REST / HTTPS
  FRONT -[#DarkGreen]-> EquiposRouter
  FRONT -[#DarkGreen]-> LigasRouter
  FRONT -[#DarkGreen]-> TemporadasRouter
  FRONT -[#DarkGreen]-> MediaRouter

  UsuariosRouter -[#DarkGreen]-> UsuarioService
  EquiposRouter  -[#DarkGreen]-> EquipoService
  LigasRouter    -[#DarkGreen]-> LigaService
  TemporadasRouter -[#DarkGreen]-> TemporadaService
  MediaRouter    -[#DarkGreen]-> MediaService
  UsuariosRouter -[#DarkGreen]-> AuthService

  UsuarioService -[#DarkGreen]-> UsuarioValidator : Validación reglas negocio
  EquipoService -[#DarkGreen]-> EquipoNFLValidator 
  EquipoService -[#DarkGreen]-> EquipoFantasyValidator
  LigaService -[#DarkGreen]-> LigaValidator
  TemporadaService -[#DarkGreen]-> TemporadaValidator
  MediaService -[#DarkGreen]-> MediaValidator

  AuthService -[#DarkGreen]-> UsuarioRepository
  UsuarioService -[#DarkGreen]-> UsuarioRepository
  EquipoService -[#DarkGreen]-> EquipoRepository
  LigaService -[#DarkGreen]-> LigaRepository
  TemporadaService -[#DarkGreen]-> TemporadaRepository
  MediaService -[#DarkGreen]-> MediaRepository

  UsuarioRepository -[#DarkGreen]-> SQLAlchemyModels
  EquipoRepository -[#DarkGreen]-> SQLAlchemyModels
  LigaRepository -[#DarkGreen]-> SQLAlchemyModels
  TemporadaRepository -[#DarkGreen]-> SQLAlchemyModels
  MediaRepository -[#DarkGreen]-> SQLAlchemyModels
  SQLAlchemyModels -[#DarkGreen]-> DB : Lectura/Escritura
}

' Sistemas externos
rectangle "<<Actor>>\nAPI Oficial NFL\n(Datos en tiempo real,\nestadísticas y calendario)" as NFL #HoneyDew
rectangle "<<Actor>>\nChatGPT API (OpenAI)\n(Recomendaciones y análisis IA)" as CHATGPT #HoneyDew
rectangle "<<Actor>>\nServicio de Correo\n(Recuperación / Avisos)" as MAIL #HoneyDew
rectangle "<<Actor>>\nCDN / Almacenamiento\n(Imágenes de perfil / escudos)" as CDN #HoneyDew

UsuarioService -[#DarkGreen]-> MAIL : Envío desbloqueo / notificaciones
MediaService -[#DarkGreen]-> CDN : Subida / Lectura de imágenes
EquipoService -[#DarkGreen]-> NFLService : Consulta datos equipos / jugadores
EquipoService -[#DarkGreen]-> ChatGPTService : Recomendaciones alineación
LigaService -[#DarkGreen]-> NFLService : Consulta calendario / standings
LigaService -[#DarkGreen]-> AnalyticsService : Métricas y reportes
EquipoService -[#DarkGreen]-> AnalyticsService : Análisis rendimiento
NFLService -[#DarkGreen]-> NFL : Consumo de API externa (lectura tiempo real)
ChatGPTService -[#DarkGreen]-> CHATGPT : Solicitudes de análisis IA
AnalyticsService -[#DarkGreen]-> ChatGPTService : Insights avanzados

' Actores externos
Usuario -[#Black]> FRONT : Interacción web\n(Registro, ligas, equipos)
Admin -[#Black]> FRONT : Panel de administración\n(Temporadas, usuarios, soporte)

note right of Sistema
  Arquitectura por capas:
  • Routers: HTTP endpoints
  • Services: Lógica de negocio
  • Repositories: Acceso a datos
  • Models: Persistencia

  Ambientes recomendados:
  • Desarrollo
  • Pruebas / Staging
  • Producción
end note

legend right
  |Fondo Azul| **En alcance** – Sistema principal |
  |Fondo Verde Claro| **Fuera de alcance** – Servicios externos |
  | | **→** Flujo principal de información |
endlegend
@enduml
