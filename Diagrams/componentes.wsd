@startuml C3
title New Generation NFL Fantasy — Diagrama de Componentes (C3)

skinparam dpi 140
skinparam rectangle {
  RoundCorner 12
}
skinparam packageStyle rectangle
skinparam linetype ortho
skinparam nodesep 10
skinparam ranksep 20
top to bottom direction

actor "Usuario / Visitante" as Usuario
actor "Operaciones X-NFL\n(Admin / Soporte)" as Admin

package "Frontend Web (React / Next.js)" #LightBlue {
  component "UI de Usuario\n(Registro / Ligas / Equipos)" as UIUser
  component "Panel Administrativo\n(Gestión de temporadas / usuarios)" as UIAdmin
  component "Módulo de Comunicación\nHTTP / REST" as UIAPI
}

package "Backend API (Python / FastAPI)" #LightBlue {
  package "Routers (Thin Controllers)" as Routers {
    component "UsuariosRouter" as UsuariosRouter
    component "EquiposRouter" as EquiposRouter
    component "LigasRouter" as LigasRouter
    component "TemporadasRouter" as TemporadasRouter
    component "MediaRouter" as MediaRouter
  }

  package "Services (Business Logic)" as Services {
    component "AuthService\n(JWT / Sesiones)" as Auth
    component "UsuarioService\n(CRUD / Perfil / Desbloqueo)" as Users
    component "EquipoService\n(Reglas por liga / Recomendaciones)" as EquipoSvc
    component "LigaService\n(Listado / Consulta / Analytics)" as LigaSvc
    component "TemporadaService\n(Gestión temporadas)" as TemporadaSvc
    component "MediaService\n(Imágenes CDN)" as MediaSvc
    component "EmailService\n(Azure Communication Email)" as Notify
    component "CDN Adapter\n(Almacenamiento imágenes)" as CDNAdapter
    component "NFLService\n(API NFL tiempo real)" as NFLSvc
    component "ChatGPTService\n(OpenAI / Recomendaciones IA)" as ChatGPTSvc
    component "AnalyticsService\n(Métricas / BI / Reportes)" as AnalyticsSvc
  }

  package "Repositories (Data Access Layer)" as RepoLayer {
    component "BaseRepository\n(Generic CRUD operations)" as BaseRepo
    component "UsuarioRepository\n(User data access)" as UserRepo
    component "LigaRepository\n(League data access)" as LigaRepo
    component "EquipoRepository\n(Team data access)" as EquipoRepo
    component "TemporadaRepository\n(Season data access)" as TemporadaRepo
    component "MediaRepository\n(Media data access)" as MediaRepo
  }

  package "Models & Database" as DataLayer {
    component "Pydantic Schemas\n(Request/Response models)" as Schemas
    component "SQLAlchemy Models\n(UsuarioDB / LigaDB / EquipoDB / etc.)" as Models
    component "Database Session\n(PostgreSQL)" as Repo
  }
}

rectangle "Servicios Externos" #HoneyDew {
  component "API Oficial NFL\n(Datos tiempo real)" as NFL
  component "ChatGPT API (OpenAI)\n(Análisis y recomendaciones)" as ChatGPT
  component "Azure Communication Services\nEmail" as Mail
  component "CDN / Almacenamiento de Imágenes" as CDN
}

' Interacciones principales - Actores a Frontend
Usuario -[#Black]--> UIUser : Navega / juega / gestiona equipos
Admin -[#Black]--> UIAdmin : Administra ligas y usuarios

' Frontend interno
UIUser -[#DarkGreen]--> UIAPI
UIAdmin -[#DarkGreen]--> UIAPI

' Frontend a Backend (Routers)
UIAPI -[#DarkGreen]--> UsuariosRouter : Usuarios
UIAPI -[#DarkGreen]--> EquiposRouter : Equipos
UIAPI -[#DarkGreen]--> LigasRouter  : Ligas
UIAPI -[#DarkGreen]--> TemporadasRouter : Temporadas
UIAPI -[#DarkGreen]--> MediaRouter  : Media

' Routers -> Services
UsuariosRouter -[#DarkGreen]--> Users
EquiposRouter  -[#DarkGreen]--> EquipoSvc
LigasRouter    -[#DarkGreen]--> LigaSvc
TemporadasRouter -[#DarkGreen]--> TemporadaSvc
MediaRouter    -[#DarkGreen]--> MediaSvc
UsuariosRouter -[#DarkGreen]--> Auth

' Services -> Repositories
Auth -[#DarkGreen]--> UserRepo
Users -[#DarkGreen]--> UserRepo
EquipoSvc -[#DarkGreen]--> EquipoRepo
LigaSvc -[#DarkGreen]--> LigaRepo
TemporadaSvc -[#DarkGreen]--> TemporadaRepo
MediaSvc -[#DarkGreen]--> MediaRepo

' Repositories -> Models & Database
BaseRepo -[#DarkGreen]--> Models
UserRepo -[#DarkGreen]--> Models
LigaRepo -[#DarkGreen]--> Models
EquipoRepo -[#DarkGreen]--> Models
TemporadaRepo -[#DarkGreen]--> Models
MediaRepo -[#DarkGreen]--> Models
Models -[#DarkGreen]--> Repo

' Servicios a Adaptadores/Externos
Users -[#DarkGreen]--> CDNAdapter : Manejo imágenes perfil
Notify -[#DarkGreen]--> Mail : Envío de correos (desbloqueo)
EquipoSvc -[#DarkGreen]--> NFLSvc : Datos equipos/jugadores tiempo real
EquipoSvc -[#DarkGreen]--> ChatGPTSvc : Recomendaciones alineación
LigaSvc -[#DarkGreen]--> NFLSvc : Calendario/estadísticas
LigaSvc -[#DarkGreen]--> AnalyticsSvc : Métricas engagement
EquipoSvc -[#DarkGreen]--> AnalyticsSvc : Análisis rendimiento
AnalyticsSvc -[#DarkGreen]--> ChatGPTSvc : Insights avanzados IA

' Adaptadores a Servicios Externos
CDNAdapter -[#DarkGreen]--> CDN
NFLSvc -[#DarkGreen]--> NFL : API tiempo real (estadísticas/proyecciones)
ChatGPTSvc -[#DarkGreen]--> ChatGPT : Solicitudes análisis IA

legend bottom
  |Fondo celeste| **En alcance** – Componentes internos |
  |Fondo verde claro| **Fuera de alcance** – Servicios externos |
  | | **→** Flujo de información / REST |
endlegend
@enduml
