@startuml C3
title New Generation NFL Fantasy — Diagrama de Componentes (C3)

skinparam dpi 100
skinparam rectangle {
  RoundCorner 12
}
skinparam componentStyle rectangle
skinparam linetype polyline
skinparam nodesep 50
skinparam ranksep 60
skinparam padding 10
skinparam wrapWidth 200
skinparam maxMessageSize 150
left to right direction

actor "Usuario / Visitante" as Usuario
actor "Operaciones X-NFL\n(Admin / Soporte)" as Admin

rectangle "Frontend Web (React / Next.js)" #LightBlue {
  component "UI de Usuario\n(Registro/Ligas/Equipos)" as UIUser
  component "Panel Administrativo\n(Gestión temporadas/usuarios)" as UIAdmin
  component "Módulo Comunicación\nHTTP/REST" as HTTPClient
}

rectangle "Backend API (Python / FastAPI)" #LightCyan {
  
  rectangle "Routers (Thin Controllers)" #AliceBlue {
    component "EquiposRouter" as EquiposRouter
    component "LigasRouter" as LigasRouter
    component "UsuariosRouter" as UsuariosRouter
    component "MediaRouter" as MediaRouter
    component "JugadoresRouter" as JugadoresRouter
    component "TemporadasRouter" as TemporadasRouter
  }
  
  rectangle "Services (Business Logic)" #LightGreen {
    component "EquipoService\n(Reglas/Recomendaciones)" as EquipoSvc
    component "LigaService\n(Listado/Analytics)" as LigaSvc
    component "UsuarioService\n(CRUD/Perfil/Desbloqueo)" as UsuarioSvc
    component "AuthService\n(JWT/Sesiones)" as AuthSvc
    component "MediaService\n(Imágenes CDN)" as MediaSvc
    component "EmailService\n(Azure Email)" as EmailSvc
    component "JugadorService\n(CRUD/Bulk)" as JugadorSvc
    component "TemporadaService\n(Gestión)" as TemporadaSvc
  }
  
  rectangle "Supporting Services" #Lavender {
    component "AnalyticsService\n(Métricas/BI/Reportes)" as AnalyticsSvc
    component "NFLService\n(API tiempo real)" as NFLSvc
    component "ChatGPTService\n(OpenAI/IA)" as ChatGPTSvc
    component "CDN Adapter\n(Almacenamiento)" as CDNAdapter
  }
  
  rectangle "Validators (Business Rules)" #LightYellow {
    component "UsuarioValidator" as UserValidator
    component "LigaValidator" as LigaValidator
    component "EquipoValidator" as EquipoValidator
    component "JugadorValidator" as JugadorValidator
    component "MediaValidator" as MediaValidator
    component "TemporadaValidator" as TemporadaValidator
  }
  
  rectangle "Repositories (Data Access)" #LightCoral {
    component "UsuarioRepository" as UserRepo
    component "LigaRepository" as LigaRepo
    component "EquipoRepository" as EquipoRepo
    component "JugadorRepository" as JugadorRepo
    component "MediaRepository" as MediaRepo
    component "TemporadaRepository" as TemporadaRepo
  }
  
  rectangle "Datos" #LightPink {
    component "Modelos SQLAlchemy\n(UsuarioDB/LigaDB/EquipoDB)" as Models
  }
}

rectangle "Servicios Externos" #HoneyDew {
  component "ChatGPT API\n(OpenAI)" as ChatGPTAPI
  component "API NFL\n(Datos real-time)" as NFLAPI
  component "CDN Storage\n(Imágenes)" as CDNStorage
  component "Azure Email\n(Comunicación)" as AzureEmail
}

database "Repositorio de Datos\n(PostgreSQL)" as DB

' User interactions
Usuario -down-> UIUser : "Navega/juega/\ngestiona equipos"
Admin -down-> UIAdmin : "Administra ligas\ny usuarios"

' Frontend to Backend
UIUser -down-> HTTPClient : "Equipos"
UIAdmin -down-> HTTPClient : "Media"
HTTPClient -down-> EquiposRouter : "Ligas"
HTTPClient -down-> LigasRouter : "Usuarios"
HTTPClient -down-> UsuariosRouter : "Backend API (Python / FastAPI)"
HTTPClient -down-> MediaRouter

' Routers to Services
EquiposRouter -down-> EquipoSvc
LigasRouter -down-> LigaSvc
UsuariosRouter -down-> UsuarioSvc
UsuariosRouter -down-> AuthSvc
MediaRouter -down-> MediaSvc
JugadoresRouter -down-> JugadorSvc
TemporadasRouter -down-> TemporadaSvc

' Services to Validators
UsuarioSvc -down-> UserValidator : "Valida reglas"
LigaSvc -down-> LigaValidator : "Valida datos"
EquipoSvc -down-> EquipoValidator : "Valida reglas"
JugadorSvc -down-> JugadorValidator
MediaSvc -down-> MediaValidator
TemporadaSvc -down-> TemporadaValidator

' Services to Supporting Services
EquipoSvc -right-> AnalyticsSvc : "Análisis"
LigaSvc -right-> AnalyticsSvc : "Estadísticas"
EquipoSvc --> NFLSvc : "Datos NFL"
EquipoSvc --> ChatGPTSvc : "Recomendaciones"
LigaSvc --> NFLSvc : "Stats NFL"
AnalyticsSvc --> ChatGPTSvc : "IA"
MediaSvc --> CDNAdapter : "Imágenes"
UsuarioSvc --> EmailSvc : "Correos"

' Supporting Services to External
ChatGPTSvc -down-> ChatGPTAPI : "Análisis IA"
NFLSvc -down-> NFLAPI : "API real-time"
CDNAdapter -down-> CDNStorage
EmailSvc -down-> AzureEmail : "Envío Email"

' Services to Repositories
UsuarioSvc -down-> UserRepo : "CRUD"
LigaSvc -down-> LigaRepo : "CRUD"
EquipoSvc -down-> EquipoRepo : "CRUD"
JugadorSvc -down-> JugadorRepo : "CRUD"
MediaSvc -down-> MediaRepo : "CRUD"
TemporadaSvc -down-> TemporadaRepo : "CRUD"
AuthSvc -down-> UserRepo : "Auth queries"

' Repositories to Models
UserRepo -down-> Models : "ORM"
LigaRepo -down-> Models : "ORM"
EquipoRepo -down-> Models : "ORM"
JugadorRepo -down-> Models : "ORM"
MediaRepo -down-> Models : "ORM"
TemporadaRepo -down-> Models : "ORM"

' Models to Database
Models -down-> DB : "SQL queries"

note bottom of DB
  <b>Celeste</b> = Componentes internos
  <b>Verde</b> = Servicios externos
  <b>-></b> Flujo REST
end note

@enduml
